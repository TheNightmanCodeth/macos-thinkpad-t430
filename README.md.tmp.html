<h2>Vanilla macOS on T430, working almost perfectly</h2>

<p><a href="http://hits.dwyl.io/{drasbeck}/{macos-thinkpad-t430}"><img src="http://hits.dwyl.io/{drasbeck}/{macos-thinkpad-t430}.svg" alt="HitCount" title="" /></a></p>

<p>Initial credits goes to ThiagoSchetini &amp; Rehabman, thanks bunches!</p>

<p>Also thanks to the contributors, you guys!! =)
* <a href="https://github.com/nghminh163">nghminh163</a>: maintenance, windows to macOS guide, i3360m SSDT 
* <a href="https://github.com/123marvin123">123marvin123</a>: fan speed fix, trackpoint fix, Mojave mic fix, high res DP/DVI out fix.</p>

<h4>WORKING =)</h4>

<ul>
<li>Intel Hyperthread (4/8 cores) - I have the i5-3320M &amp; i7-3632QM.</li>
<li>Intel TurboBoost</li>
<li>Intel SpeedStep</li>
<li>CPU HW Monitor (temps, clock and power)</li>
<li>RAM DDR3 at 1600mhz</li>
<li>Intel HD4000 1536MB</li>
<li>Brightness (FULL Range + Fn Brightness Keys)</li>
<li>Display Port Out: FullHD + Audio</li>
<li>Battery Status</li>
<li>Wi-Fi (I use an Atheros AR5BHB92 <a href="https://github.com/ThiagoSchetini/AR9285-rebranding">rebranded</a>)</li>
<li>Ethernet</li>
<li>Sleep</li>
<li>Display turns on automatically on wake/instant wake</li>
<li>USB 3.0 Full Speed</li>
<li>Audio ALC269</li>
<li>Webcam + Mic</li>
<li>Keyboard + TouchPad</li>
<li>Bluetooth: bought and installed this <a href="https://www.aliexpress.com/item/Free-shipping-New-original-bluetooth-module-4-0-for-Lenovo-Thinkpad-X220-X230-T420-T430-T530/1640038938.html">BT daughter card</a> worked out of the box. <em>Sadly no Handoff - yet</em></li>
</ul>

<h4>NOT WORKING ...</h4>

<ul>
<li>VGA output</li>
<li>SD Card Reader &lt;- never tested</li>
</ul>

<h4>Creating the installer</h4>

<pre><code>- You'll need thumbdrive of at least 8 GB, HFS+ formatted.

- Use Unibeast to create the installer. Select UEFI and no ATI/nVidia.

- After creating the USB Installer go to EFI/CLOVER/drivers64UEFI/
    Remove everything and put the 4 files this repository (add the apfs.efi if need be)

- Put any kexts in EFI/CLOVER/kexts/10.12 etc. into ./other/ and copy the kexts from this
  repository into ./other/ as well.
    - Thus removing all kexts folders except ./other/
</code></pre>

<h4>Install macOS</h4>

<pre><code>- You'll need a mouse and external keyboard plugged in (for the install process).

- If you get stuck on boot disable 'InjectIntel' graphics.
</code></pre>

<h5>Install on Fusion Drive (Optional)</h5>

<p>If you have installed an SSD and a HDD in your T430, you can gain the advantages of using a fusion drive. Follow these steps to install on a fusion drive rather than a "regular" drive.</p>

<pre><code>- Setup Fusion drive according to guides on the internet.

- Install macOS on external HDD.

- Restore HDD installation to Fusion Drive with Disk Utility on the install disk.

- *Alternatively* (never got this to work) do `/Volumes/"Image Volume/Install macOS High Sierra.app"
    /Contents/Resources/startosinstall --volume the_target_volume--converttoapfs NO --agreetolicense`
    from Terminal instead of regular install.

- Boot into new installation on Fusion Drive.
</code></pre>

<h4>Show hidden files (optional, but helpful)</h4>

<pre><code>- After first boot, on Terminal:
    defaults write com.apple.finder AppleShowAllFiles YES
    killAll Finder
</code></pre>

<h4>Install OpenCore</h4>

<pre><code>- Obtain latest build of [OpenCorePkg](https://github.com/acidanthera/OpenCorePkg)
    - Build from latest source with `macbuild.tool`
</code></pre>

<h4>Configure EFI/Clover</h4>

<pre><code>- config.plist: use the one from this repository
    take from low-resolution-config.plist folder for 1366x768 display
    take from high-resolution-config.plist folder for 1600x900 or + display

- /drivers64UEFI
    use the folder from this repository (with 4 files only!)

- /kexts
    Remove everything except other (leave it empty)

- /ACPI/patched:
    (OPTION 1 Difficult - but recommended) Make your own SSDT and DSDT:
        -&gt; First you'll need the vanilla .aml generated by your UEFI (BIOS)
            When in the clover boot menu press F4 (and Fn+F4 just in case)
            That’s it. You can find the files needed in EFI/CLOVER/ACPI/origin

        -&gt; Then disassemble the DSDT.aml and SSDT’s.aml (0, 1, 2 etc…) only:
            never open these files directly with MacIASL, as it will actually ruin them
            instead copy the .aml's to their own directory with the refs.txt from tools/iasl
            use the iasl command in terminal (see tools/iasl/howTo.txt)

        -&gt; patch your DSDT.dsl with all the code from file “…-dsdt-patch.txt” using MacIASL
            it includes only the necessary code to Thinkpad T430
            * choose low resolution for 1366 x 762
            * choose high resolution for 1600 x 900 or +

        -&gt; patch with "fan patch/t430-fan-patch.txt" DSDT file using maciASL. 

        -&gt; manually last patch for screen turn on after wake (Warning! It’s a manual change)
            on your .dsl find for “Return (WAKI)”
            In the method calls above "Return (WAKI)" you'll find:
                \_SB.PCI0.LPC.EC.LED(Zero, 0x80)
                \_SB.PCI0.LPC.EC.LED(0x07, 0x00)
            substitute these two lines with:
                \_SI._SST (One)
                    \_GPE._L1D ()
            (identation must be at the same depth as the substituted lines):

        -&gt; Use MacIASL to save as ACPI Machine Language Binary (DSDT.aml)
            and copy file to ACPI/patched on the clover UEFI

        -&gt; Generate your own SSDT (Power Management for your processor)
            https://www.tonymacx86.com/threads/quick-guide-to-generate-a-ssdt-for-cpu-power-management.177456/
        -&gt; Put the SSDT.aml on the same folder of DSDT: ACPI/patched inside clover UEFI


    (OPTION 2 Easy One - Not recommended) take my patched files .aml:
        -&gt;take ONLY the .aml files from “pached ACPI dsl’s” folder
            * choose only one SSDT.aml: “i5 3230M” or “i7 3632QM”
            * if you have another processor make your own SSDT or leave it empty

        -&gt; Put the .aml files on the folder: ACPI/patched inside clover UEFI
</code></pre>

<h4>Kexts</h4>

<pre><code>- Make a backup of AppleBacklight.kext (Brightness)
    Why? for future updates you need to reinstall the original and then reinstall the pached

    ** Warning!, the backlight kext inside kexts folder is patched for T430 brightness full range control

- Now, install all the kexts from the folder using “Kext Utility.app” (look inside tools folder)
    - Be sure to use ACPIPoller.kext from this repo because it uses a modified Info.plist
</code></pre>

<h4>Voodoo Extra Files (for Keyboard)</h4>

<pre><code>- Go to the voodoo's' folder with the terminal
    sudo cp org.rehabman.voodoo.driver.Daemon.plist /Library/LaunchDaemons
    sudo cp VoodooPS2Daemon /usr/bin
</code></pre>

<h4>Restart at get audio working</h4>

<pre><code>- After restarting you need to flush the kexts:
    sudo touch /System/Library/Extensions &amp;&amp; sudo kextcache -u /
- Restart again to hear the audio working!

- Repeat the process if nescessary
    sudo touch /System/Library/Extensions &amp;&amp; sudo kextcache -u /
- Restart Again!

* If you keep having problems, try disabling the option 'No Cache' in config.plist and restart again.
</code></pre>

<h4>HWMONITOR</h4>

<pre><code>- Put the HWMONITOR from tools folder in Applications and open it, you should read power, clock, and temps of your CPU
</code></pre>

<h4>Disable Hibernation</h4>

<pre><code>-&gt; Disable Hibernation and related options
    sudo pmset -a hibernatemode 0
    sudo rm /var/vm/sleepimage
    sudo mkdir /var/vm/sleepimage
    sudo pmset -a standby 0
    sudo pmset -a autopoweroff 0
</code></pre>

<p><strong>And that's it! You're done. (Hopefully.)</strong> =)</p>

<h4>ABOUT THIS DSDT CODE</h4>

<pre><code>-&gt; ThiagoSchetini modified some original patches from Rehabman:

        [modified] Lenovo X220
            -&gt; added T430 sleep leds
            -&gt; cleaned extra code

        [modified] Brightness fix (HD3000/HD4000)
            -&gt; included FN brightness keys (T430 only)

        [usb] USB3_PRW 0x0D (instant wake)
            -&gt; to have sleep working (original Rehabman code)

        [audio] Audio Layout 29
            -&gt; to work with the ALC269 kext (original Rehabman code)

        [sys] IRQ Fix
            -&gt; to enable audio (original Rehabman code)

        [igpu] Low Resolution (or High)
            -&gt; to enable HDMI display port audio out

        [manual] Code change on .dsl to turn on screen automatically on wake
</code></pre>

<h4>COMPLETE KEXT FLUSH (recomended after remove a kext)</h4>

<pre><code>-&gt; repair permissions:
    sudo /usr/libexec/repair_packages --repair --standard-pkgs --volume /

-&gt; rebuild kext cache
    sudo rm -r /System/Library/Caches/com.apple.kext.caches
    sudo touch /System/Library/Extensions
    sudo kextcache -update-volume /

-&gt; rebuild cache short form
    sudo touch /System/Library/Extensions &amp;&amp; sudo kextcache -u /
</code></pre>

<h4>GENERATE VANILLA CONFIG.PLIST (if you need it)</h4>

<pre><code>on /usr/local/bin/clover-genconfig &gt; config.plist
execute and take the xml
</code></pre>

<h4>HOW TO FLASH T430 BIOS (if you want to install an 1300AC Wi-Fi …)</h4>

<p>https://github.com/bibanon/Coreboot-ThinkPads/wiki/xx30-BIOS-Whitelist-Removal</p>

<h2>Updates</h2>

<p>A running log of the changes made with each released update can be found <a href="update_log.md">here</a>.</p>
